<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Installer By OOM</title>
    <script src="https://cdn.jsdelivr.net/npm/esptool-js@0.4.0/bundle.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; background: #1a1a1a; color: white; padding: 50px; }
        .card { background: #2a2a2a; padding: 30px; border-radius: 20px; display: inline-block; border: 2px solid #00f2ff; }
        #status { font-size: 18px; color: #00f2ff; margin: 20px; }
        .btn { padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 10px; border: none; font-weight: bold; }
        #connect-btn { background: #00f2ff; color: black; }
        #flash-btn { background: #ff00ff; color: white; display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üöÄ ESP32 Web Installer</h1>
        <p id="status">üî¥ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
        <button id="connect-btn" class="btn">1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
        <button id="flash-btn" class="btn">2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <script>
        let esploader;
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ (Library) ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏´‡∏°
        function checkLib() {
            return window.esptooljs || window.esptool;
        }

        document.getElementById('connect-btn').onclick = async () => {
            const lib = checkLib();
            if (!lib) {
                alert("‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏≤! ‡∏•‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö‡∏ô‡∏≤‡∏¢");
                return;
            }

            try {
                const port = await navigator.serial.requestPort();
                await port.open({ baudRate: 115200 });
                
                const transport = new lib.Transport(port);
                esploader = new lib.ESPLoader(transport, 115200);
                
                document.getElementById('status').innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠... (‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° BOOT ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö)";
                await esploader.main();
                
                document.getElementById('status').innerText = "‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ü‡∏•‡∏±‡∏ä‡πÅ‡∏•‡πâ‡∏ß";
                document.getElementById('status').style.color = "#00ff00";
                document.getElementById('connect-btn').style.display = "none";
                document.getElementById('flash-btn').style.display = "inline-block";
            } catch (e) {
                alert("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + e.message);
            }
        };

        document.getElementById('flash-btn').onclick = async () => {
            try {
                const firmwareUrl = "https://raw.githubusercontent.com/oompack4-oss/esp32-firmware/main/sketch_feb6a.ino.bin";
                document.getElementById('status').innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á... ‡∏´‡πâ‡∏≤‡∏°‡∏ñ‡∏≠‡∏î‡∏™‡∏≤‡∏¢!";
                
                const response = await fetch(firmwareUrl);
                const contents = await response.arrayBuffer();

                await esploader.writeFlash({
                    fileArray: [{ data: contents, address: 0x1000 }],
                    flashSize: 'keep', eraseAll: false, compress: true,
                    reportProgress: (fileIndex, written, total) => {
                        const prog = Math.round((written / total) * 100);
                        document.getElementById('status').innerText = "‚ö° ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß " + prog + "%";
                    }
                });

                document.getElementById('status').innerText = "üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≤‡∏¢! ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢";
                document.getElementById('status').style.color = "#ffff00";
            } catch (e) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ï‡∏≠‡∏ô‡∏ü‡∏•‡∏±‡∏ä: " + e.message);
            }
        };
    </script>
</body>
</html>

